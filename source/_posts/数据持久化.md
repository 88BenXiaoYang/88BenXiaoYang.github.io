---
title: 数据持久化
date: 2019-01-10 18:46:41
tags: iOS
categories: 移动端
---

### `plist`文件存储数据

* 生成`plist`文件：

```
1.建立文件管理
NSFileManager *fm = [NSFileManager defaultManager];

2.找到 Documents 文件所在的路径
NSArray *path = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);

3.取得第一个 Documents 文件夹的路径
NSString *filePath = [path objectAtIndex:0];

4.把要生成的 plist 文件名称(xxx.plist)添加到文件夹路径后面
NSString *plistPath = [filePath stringByAppendingPathComponent:@"xxx.plist"];

5.创建文件
[fm createFileAtPath:plistPath contents:nil attributes:nil];

//操作过程中如需删除文件，用以下代码
[fm removeItemAtPath:plistPath error:nil];
```

* 往`plist`文件中写入数据

```
注：将数据存入 plist 文件之前，先确定所存储的数据类型，根据所存储的数据类型构建对应的对象。
以存储的数据类型为字典为例，在写入数据之前，需要把数据先存入字典中。

1.创建字典并把数据存入字典中
NSDictionary *dic = [NSDictionary dictionaryWithObjectsAndKeys:@"key1",@"value1",@"key2",@"value2", nil];

2.把字典写入 plist 文件
[dic writeToFile:plistPath atomically:YES];
```

* 从`plist`文件中读取数据

```
1.根据“生成`plist`文件”的过程，获取 plist 文件所在的路径

2.读取plist文件，用 plist 所存储的数据类型对应的对象接收所读出的数据（如：存储的是字典用字典接收；存储的是数组用数组接收），以字典为例。
NSDictionary *dic2 = [NSDictionary dictionaryWithContentsOfFile:plistPath];

3.根据字典的取值规则，取到所需数据
```

* 示例（将从服务器请求到的数据存入`plist`文件）：

```
1.解析请求到的数据
NSMutableArray *dataArr = [responseDictionary objectForKey:@"dataList"];

2.建立文件夹管理
NSFileManager *fm = [NSFileManager defaultManager];

3.找到Documents文件所在的路径
NSArray *path = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);

4.取得第一个Documents文件夹的路径
NSString *filePath = [path objectAtIndex:0];

5.把要存储数据的 plist 文件名称追加到路径后面
NSString *plistPath = [filePath stringByAppendingPathComponent:@"xxx.plist"];

6.开始创建文件
[fm createFileAtPath:plistPath contents:nil attributes:nil];

7.往 plist 文件中写入数据
[dataArr writeToFile:plistPath atomically:YES];
```

### 归档/解档

要将一个自定义的类进行归档，那么类里面的每个属性都必须是可以被归档的，如果是不能归档的类型，可以把他转化为`NSValue`进行归档，然后在读出来的时候再转化为相应的类。

自定义的类需要实现：

* 归档方法，`encodeWithCoder`
* 解档方法，`decodeObjectForKey`，通常在`initWithCoder`中调用
* 拷贝方法，`copyWithZone`，实现字符串的`copy`
